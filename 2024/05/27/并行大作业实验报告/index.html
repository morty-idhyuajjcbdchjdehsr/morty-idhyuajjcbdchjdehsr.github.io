<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  
  <meta name="generator" content="Hexo 7.2.0">

  

  

  
    <meta name="author" content="lzf">
  

  

  

  <title>Standford cs149 asset1 | Morty的小站</title>

  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  <!--mathjax latex数学公式显示支持-->
  
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.13/index.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/monokai.min.css">
  

  

  
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(/img/1680584184078.png)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          Morty的小站
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">首页</a></li>
        
          <li class="navbar-list-item"><a href="/links">友链</a></li>
        
          <li class="navbar-list-item"><a href="/message">留言</a></li>
        
          <li class="navbar-list-item"><a href="/about">关于</a></li>
        
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap">Standford cs149 asset1</h1>
          <h2 class="title-sub-wrap">
            <strong>lzf</strong>
            <span>发布于</span>
            <time  class="article-date" datetime="2024-05-27T05:44:31.000Z" itemprop="datePublished">2024-05-27</time>
          </h2>
          
          
            <h2 id="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="title-sub-wrap leancloud_visitors" data-flag-title="Standford cs149 asset1">
              <em>文章访问量</em>
              <i class="leancloud-visitors-count"></i>
            </h2>
          
          <ul class="wrap-list dark">
  
    <li><a href="/categories/Homework/">📒 Homework</a></li>
  
</ul>
          <ul class="wrap-list dark">
  
    <li><a href="/tags/Parallel-Programming/">🏷️ Parallel Programming</a></li>
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- 文章 -->

<!-- 文章内容 -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <h1 id="stanford并行程序设计asset1：四核CPU性能分析"><a href="#stanford并行程序设计asset1：四核CPU性能分析" class="headerlink" title="stanford并行程序设计asset1：四核CPU性能分析"></a>stanford并行程序设计asset1：四核CPU性能分析</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本作业旨在帮助你理解现代多核CPU中的两种主要并行执行形式：</p>
<ol>
<li>单个处理核心内的SIMD执行</li>
<li>使用多个核心的并行执行（你还会看到Intel超线程的效果）</li>
</ol>
<p>你还将获得测量和分析并行程序性能的经验（这是一个具有挑战性但重要的技能，你将在本课程中多次使用）。这个作业涉及少量的编程，但需要大量的分析！</p>
<h2 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h2><p><strong>你需要在新的myth机器上运行代码来完成这个作业</strong><br>（这些机器的主机名为<code>myth[51-66].stanford.edu</code>）。如果因为某些原因你在myth机器上没有主目录，请在<a target="_blank" rel="noopener" href="https://stanford.service-now.com/it_services?id=sc_cat_item&sys_id=cab169801bd918d0685d4377cc4bcbe0">这里</a>提交一个HelpSU票据。</p>
<p>这些机器包含四核4.2 GHz的Intel Core i7处理器（尽管动态频率缩放可以在芯片认为有用且可能的情况下将其提升到4.5 GHz）。处理器中的每个核心支持两个硬件线程（Intel称之为“超线程”），并且这些核心可以执行AVX2向量指令，这些指令描述了对多个单精度数据值执行相同的八宽操作。对于好奇的人，可以在<a target="_blank" rel="noopener" href="https://ark.intel.com/products/97129/Intel-Core-i7-7700K-Processor-8M-Cache-up-to-4-50-GHz-">https://ark.intel.com/products/97129/Intel-Core-i7-7700K-Processor-8M-Cache-up-to-4-50-GHz-</a>找到这个CPU的完整规格。想深入了解的学生可能会喜欢<a target="_blank" rel="noopener" href="https://en.wikichip.org/wiki/intel/microarchitectures/kaby_lake">这篇文章</a>。</p>
<p>注意：为了评分目的，我们希望你报告在Stanford的myth机器上运行代码的性能，然而，你也可以在自己的机器上运行这些作业中的程序（你首先需要安装Intel SPMD程序编译器（ISPC），可以在<a target="_blank" rel="noopener" href="http://ispc.github.io/">http://ispc.github.io/</a>找到）。如果你在其他机器上运行代码，也可以在报告中包含你的发现，只需非常清楚地说明你在哪台机器上运行。</p>
<p>开始：</p>
<ol>
<li>需要安装ISPC来编译用于这个作业的许多程序。ISPC可以通过以下步骤在myth机器上轻松安装：</li>
</ol>
<p>从myth机器上，在你选择的本地目录中下载linux二进制文件。你可以从ISPC的<a target="_blank" rel="noopener" href="https://ispc.github.io/downloads.html">下载页面</a>获取Linux的ISPC编译器二进制文件。从<code>myth</code>上，我们建议你使用<code>wget</code>直接从下载页面下载二进制文件。截至2023年秋季第一周，下面的<code>wget</code>行是有效的：</p>
<pre><code>wget https://github.com/ispc/ispc/releases/download/v1.21.0/ispc-v1.21.0-linux.tar.gz
</code></pre>
<p>解压下载的文件：<code>tar -xvf ispc-v1.21.0-linux.tar.gz</code></p>
<p>将ISPC的<code>bin</code>目录添加到你的系统路径。例如，如果解压文件生成了目录<code>~/Downloads/ispc-v1.21.0-linux</code>，在bash中你可以用以下命令更新你的路径变量：</p>
<pre><code>export PATH=$PATH:$&#123;HOME&#125;/Downloads/ispc-v1.21.0-linux/bin
</code></pre>
<p>可以将上述行添加到你的<code>.bashrc</code>文件中以使其永久生效。</p>
<p>如果你使用csh，可以使用<code>setenv</code>更新你的<code>PATH</code>。一个快速的Google搜索可以教你如何做。</p>
<ol start="2">
<li><p>作业的起始代码在<a target="_blank" rel="noopener" href="https://github.com/stanford-cs149/asst1">https://github.com/stanford-cs149/asst1</a>上可用。请使用以下命令克隆作业1的起始代码：</p>
<p> <code>git clone https://github.com/stanford-cs149/asst1.git</code></p>
</li>
</ol>
<h2 id="程序1：使用线程并行生成分形（20分）"><a href="#程序1：使用线程并行生成分形（20分）" class="headerlink" title="程序1：使用线程并行生成分形（20分）"></a>程序1：使用线程并行生成分形（20分）</h2><p>在代码库的<code>prog1_mandelbrot_threads/</code>目录中构建并运行代码。（输入<code>make</code>来构建，输入<code>./mandelbrot</code>来运行它。）这个程序生成图像文件<code>mandelbrot-serial.ppm</code>，这是一个称为Mandelbrot集合的著名复数集的可视化。大多数平台都有.ppm查看器。要远程查看生成的图像，首先确保你有_X服务器_。Linux系统不需要下载任何软件。然而，Mac用户可以使用<a target="_blank" rel="noopener" href="https://www.xquartz.org/">Xquartz</a>，Windows用户可以使用<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a>。在你获得SSH X转发支持后，确保你使用<code>ssh -Y</code>连接到myth机器，然后你可以使用<code>display</code>命令查看图像。如下面的图像所示，结果是一个熟悉且美丽的分形。图像中的每个像素对应于复平面中的一个值，每个像素的亮度与确定该值是否包含在Mandelbrot集合中的计算成本成正比。要获得图像2，请使用命令选项<code>--view 2</code>。（见<code>mandelbrotSerial.cpp</code>中定义的函数<code>mandelbrotSerial()</code>）。你可以在<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Mandelbrot_set">http://en.wikipedia.org/wiki/Mandelbrot_set</a>了解更多关于Mandelbrot集合的定义。</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527143958026.png" alt="image-20240527143958026.png"></p>
<p>你的任务是使用<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/thread/thread">std::thread</a>并行化图像的计算。起始代码在<code>mandelbrotThread.cpp</code>中的函数<code>mandelbrotThread()</code>中生成了一个额外的线程。在这个函数中，主应用程序线程使用构造函数<code>std::thread(function, args...)</code>创建另一个线程。它通过调用线程对象上的<code>join</code>等待这个线程完成。目前启动的线程没有进行任何计算，并立即返回。你应该添加代码到<code>workerThreadStart</code>函数来完成这个任务。你不需要在这个作业中使用任何其他std::thread API调用。</p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li>修改起始代码，使用两个处理器并行生成Mandelbrot图像。具体来说，在线程0中计算图像的上半部分，在线程1中计算图像的下半部分。这种问题分解类型称为_空间分解_，因为图像的不同空间区域由不同的处理器计算。</li>
<li>扩展你的代码，使用2、3、4、5、6、7和8个线程，相应地分配图像生成工作（线程应获得图像的块）。注意，处理器只有四个核心，但每个核心支持两个超线程，所以它可以在其执行内容上交错执行总共八个线程。在你的报告中，生成__与参考顺序实现相比的加速图表__，作为所用线程数量的函数__对于视图1__。加速是否与所用线程数量呈线性关系？在你的报告中假设为什么会（或不会）这样？（你可能还希望为视图2生成一个图表，以帮助你提出一个好的答案。提示：仔细看看三线程的数据点。）</li>
<li>为了确认（或推翻）你的假设，通过在<code>workerThreadStart()</code>的开始和结束插入计时代码来测量每个线程完成其工作的时间。你的测量结果如何解释你之前创建的加速图表？</li>
<li>修改工作到线程的映射，以在__两个视图上获得大约7-8倍的加速__（如果超过7倍，那就可以了，不要担心）。你不能在你的解决方案中使用任何线程间的同步。我们期望你提出一个适用于所有线程数的单一工作分配策略——不允许对每个配置进行特定的硬编码解决方案！（提示：有一个非常简单的静态分配可以实现这个目标，并且不需要在线程之间进行通信&#x2F;同步。）在你的报告中描述你的并行化方法，并报告最终获得的8线程加速。</li>
<li>现在用16个线程运行你的改进代码。性能是否明显比使用八个线程时更高？为什么或为什么不？</li>
</ol>
<h5 id="我的实现"><a href="#我的实现" class="headerlink" title="我的实现"></a><strong>我的实现</strong></h5><p>（1）代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">workerThreadStart</span><span class="params">(WorkerArgs * <span class="type">const</span> args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO FOR CS149 STUDENTS: Implement the body of the worker</span></span><br><span class="line">    <span class="comment">// thread here. Each thread should make a call to mandelbrotSerial()</span></span><br><span class="line">    <span class="comment">// to compute a part of the output image.  For example, in a</span></span><br><span class="line">    <span class="comment">// program that uses two threads, thread 0 could compute the top</span></span><br><span class="line">    <span class="comment">// half of the image and thread 1 could compute the bottom half.</span></span><br><span class="line">    <span class="type">int</span> rows_for_thread = args-&gt;height / args-&gt;numThreads;</span><br><span class="line">    <span class="type">int</span> start_row = args-&gt;threadId * rows_for_thread;</span><br><span class="line">    <span class="keyword">if</span>(args-&gt;threadId == args-&gt;numThreads <span class="number">-1</span>)&#123; <span class="comment">// 是最后一个线程</span></span><br><span class="line">        rows_for_thread = rows_for_thread + (args-&gt;height % args-&gt;numThreads); <span class="comment">//加上余出的部分</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">mandelbrotSerial</span>(args-&gt;x0, args-&gt;y0, args-&gt;x1, args-&gt;y1, </span><br><span class="line">        args-&gt;width, args-&gt;height, start_row, rows_for_thread, </span><br><span class="line">        args-&gt;maxIterations, args-&gt;output);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello world from thread %d\n&quot;</span>, args-&gt;threadId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（2）加速比图表：</p>
<table>
<thead>
<tr>
<th>线程数</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody><tr>
<td>加速比</td>
<td>1.98</td>
<td>1.63</td>
<td>2.44</td>
<td>2.48</td>
<td>3.25</td>
<td>3.38</td>
<td>3.92</td>
</tr>
</tbody></table>
<p>一般来说，线程越多，程序运行速度越快。然而，对于k个线程，程序的运行速度并没有提高k倍。我认为原因是线程之间的工作负载不平衡。在这个实现中，如果threadnum是k，那么图片水平分成k个块，线程i负责第i个块。在三个线程和视图1的情况下，中间的行(有更多的白色部分)需要更多的计算，所以第二个线程比其他两个线程运行得慢得多，甚至比两个线程——视图1的情况下的线程还要慢。这解释了上图中2和3之间的下降。</p>
<p>（3）</p>
<p>测量时间如下：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527103655892.png" alt="image-20240527103655892.png"></p>
<p>对于视图1，我们可以看到处理中间行(线程2、5、4、3)的线程比其他线程运行得慢得多。</p>
<p>（4）并行化方法：解决方法很简单，如果线程数是n，线程I负责图片的k * n + I行。</p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">mandelbrotStepSerial</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">float</span> x0, <span class="type">float</span> y0, <span class="type">float</span> x1, <span class="type">float</span> y1,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> width, <span class="type">int</span> height,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> startRow, <span class="type">int</span> step,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> maxIterations,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> output[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> dx = (x1 - x0) / width;</span><br><span class="line">    <span class="type">float</span> dy = (y1 - y0) / height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = startRow; j &lt; height; j+=step) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; width; ++i) &#123;</span><br><span class="line">            <span class="type">float</span> x = x0 + i * dx;</span><br><span class="line">            <span class="type">float</span> y = y0 + j * dy;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> index = (j * width + i);</span><br><span class="line">            output[index] = <span class="built_in">mandel</span>(x, y, maxIterations);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">void</span> <span class="title">mandelbrotStepSerial</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">float</span> x0, <span class="type">float</span> y0, <span class="type">float</span> x1, <span class="type">float</span> y1,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> width, <span class="type">int</span> height,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> startRow, <span class="type">int</span> step,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> maxIterations,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> output[])</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">workerThreadStart</span><span class="params">(WorkerArgs * <span class="type">const</span> args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO FOR CS149 STUDENTS: Implement the body of the worker</span></span><br><span class="line">    <span class="comment">// thread here. Each thread should make a call to mandelbrotSerial()</span></span><br><span class="line">    <span class="comment">// to compute a part of the output image.  For example, in a</span></span><br><span class="line">    <span class="comment">// program that uses two threads, thread 0 could compute the top</span></span><br><span class="line">    <span class="comment">// half of the image and thread 1 could compute the bottom half.</span></span><br><span class="line">    <span class="type">double</span> startTime = CycleTimer::<span class="built_in">currentSeconds</span>();</span><br><span class="line">    <span class="comment">// Method 2: thread i computes all the rows which is k * numThread + i</span></span><br><span class="line">    <span class="built_in">mandelbrotStepSerial</span>(args-&gt;x0, args-&gt;y0, args-&gt;x1, args-&gt;y1,</span><br><span class="line">    args-&gt;width, args-&gt;height, args-&gt;threadId, args-&gt;numThreads, args-&gt;maxIterations, args-&gt;output);</span><br><span class="line">    <span class="type">double</span> endTime = CycleTimer::<span class="built_in">currentSeconds</span>();</span><br><span class="line">    <span class="type">double</span> minSerial = std::<span class="built_in">min</span>(<span class="number">1e30</span>, endTime - startTime);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[mandelbrot for thread %d]:\t\t[%.3f] ms\n&quot;</span>, args-&gt;threadId,minSerial * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527104852576.png" alt="image-20240527104852576.png"></p>
<p>加速比为6.88</p>
<p>（5）</p>
<p>使用16线程运行代码：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527104934546.png" alt="image-20240527104934546.png"></p>
<p>加速比为 11.48 ，性能比8线程要好，因为线程数是其两倍</p>
<h2 id="程序2：使用SIMD内在函数进行向量化代码（20分）"><a href="#程序2：使用SIMD内在函数进行向量化代码（20分）" class="headerlink" title="程序2：使用SIMD内在函数进行向量化代码（20分）"></a>程序2：使用SIMD内在函数进行向量化代码（20分）</h2><p>查看Assignment 1代码库的<code>prog2_vecintrin/main.cpp</code>中的<code>clampedExpSerial</code>函数。<code>clampedExp()</code>函数将<code>values[i]</code>提升到由<code>exponents[i]</code>给定的幂，并将结果值限制在9.999999。在程序2中，你的任务是向量化这段代码，使其可以在具有SIMD向量指令的机器上运行。</p>
<p>然而，与其使用映射到现代CPU上真实SIMD向量指令的SSE或AVX2向量内在函数，为了让事情更容易一些，我们要求你</p>
<p>使用CS149的“伪向量内在函数”来实现你的版本，这些函数定义在<code>CS149intrin.h</code>中。<code>CS149intrin.h</code>库为你提供了一组操作向量值和&#x2F;或向量掩码的向量指令。（这些函数不会转换为真实的CPU向量指令，而是我们在库中模拟这些操作，并提供便于调试的反馈。）作为使用CS149内在函数的示例，<code>main.cpp</code>中给出了一个向量化版本的<code>abs()</code>函数。这个示例包含了一些基本的向量加载和存储，并操纵掩码寄存器。注意，<code>abs()</code>示例只是一个简单的例子，事实上代码并不能正确处理所有输入！（我们会让你来弄清楚为什么！）你可能希望阅读<code>CS149intrin.h</code>中的所有注释和函数定义，以了解有哪些操作可供使用。</p>
<p>以下是一些提示，帮助你实现：</p>
<ul>
<li>每个向量指令都有一个可选的掩码参数。掩码参数定义了哪些通道的输出在这个操作中被“掩码”。掩码中的0表示该通道被掩码，因此其值不会被向量操作的结果覆盖。如果操作中没有指定掩码，则没有通道被掩码。（注意，这相当于提供一个全1的掩码。）<br><em>提示：</em> 你的解决方案将需要使用多个掩码寄存器和库中提供的各种掩码操作。</li>
<li><em>提示：</em> 使用<code>_cs149_cntbits</code>函数在这个问题中很有用。</li>
<li>考虑如果循环迭代总数不是SIMD向量宽度的倍数会发生什么。我们建议你用<code>./myexp -s 3</code>测试你的代码。<em>提示：</em> 你可能会发现<code>_cs149_init_ones</code>有用。</li>
<li><em>提示：</em> 使用<code>./myexp -l</code>在最后打印执行的向量指令日志。使用函数<code>addUserLog()</code>在日志中添加自定义调试信息。随意添加额外的<code>CS149Logger.printLog()</code>来帮助你调试。</li>
</ul>
<p>程序的输出将告诉你你的实现是否生成了正确的输出。如果有不正确的结果，程序会打印出它找到的第一个，并打印出函数输入和输出的表格。你的函数的输出在“output &#x3D;”之后，应该与“gold &#x3D;”之后的结果匹配。程序还会打印出描述CS149伪向量单元利用率的统计信息。你应该将“总向量指令”值视为你实现的性能指标。（你可以假设每个CS149伪向量指令在CS149伪SIMD CPU上需要一个周期。）“向量利用率”显示启用的向量通道的百分比。</p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li>在<code>clampedExpVector</code>中实现<code>clampedExpSerial</code>的向量化版本。你的实现应该适用于任意组合的输入数组大小（<code>N</code>）和向量宽度（<code>VECTOR_WIDTH</code>）。</li>
<li>运行<code>./myexp -s 10000</code>并扫过向量宽度从2、4、8到16。记录得到的向量利用率。你可以通过更改<code>CS149intrin.h</code>中的<code>#define VECTOR_WIDTH</code>值来实现这一点。向量利用率随着<code>VECTOR_WIDTH</code>的变化是增加、减少还是保持不变？为什么？</li>
<li><em>额外奖励：（1分）</em> 在<code>arraySumVector</code>中实现<code>arraySumSerial</code>的向量化版本。你的实现可以假设<code>VECTOR_WIDTH</code>是输入数组大小<code>N</code>的因数。虽然顺序实现运行在<code>O(N)</code>时间内，但你的实现应该旨在达到<code>(N / VECTOR_WIDTH + VECTOR_WIDTH)</code>或甚至<code>(N / VECTOR_WIDTH + log2(VECTOR_WIDTH))</code>的运行时间。你可能会发现<code>hadd</code>和<code>interleave</code>操作有用。</li>
</ol>
<h5 id="我的实现-1"><a href="#我的实现-1" class="headerlink" title="我的实现"></a>我的实现</h5><p>（1）</p>
<p>clampedExpVector 代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">clampedExpVector</span><span class="params">(<span class="type">float</span>* values, <span class="type">int</span>* exponents, <span class="type">float</span>* output, <span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// CS149 STUDENTS <span class="doctag">TODO:</span> Implement your vectorized version of</span></span><br><span class="line">  <span class="comment">// clampedExpSerial() here.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Your solution should work for any value of</span></span><br><span class="line">  <span class="comment">// N and VECTOR_WIDTH, not just when VECTOR_WIDTH divides N</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  __cs149_mask mask_ones = _cs149_init_ones();</span><br><span class="line">  __cs149_mask mask_zeros = _cs149_mask_not(mask_ones);</span><br><span class="line">  __cs149_vec_int v_int_zeros = _cs149_vset_int(<span class="number">0</span>);</span><br><span class="line">  __cs149_vec_int v_int_ones = _cs149_vset_int(<span class="number">1</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i += VECTOR_WIDTH) &#123;</span><br><span class="line">    <span class="comment">// 初始化v_output</span></span><br><span class="line">    <span class="type">int</span> offset = i;</span><br><span class="line">    <span class="keyword">if</span> (offset + VECTOR_WIDTH &gt; N) &#123;</span><br><span class="line">      <span class="comment">// 中间有一部分数据重叠，二次计算</span></span><br><span class="line">      offset = N - VECTOR_WIDTH;</span><br><span class="line">    &#125;</span><br><span class="line">    __cs149_vec_float v_values;</span><br><span class="line">    _cs149_vload_float(v_values, values + offset, mask_ones);</span><br><span class="line">    __cs149_vec_float v_output = _cs149_vset_float(<span class="number">1</span>);</span><br><span class="line">    __cs149_vec_int v_exponents;</span><br><span class="line">    _cs149_vload_int(v_exponents, exponents + offset, mask_ones);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化mask</span></span><br><span class="line">    __cs149_mask mask_operation;</span><br><span class="line">    _cs149_veq_int(mask_operation, v_exponents, v_int_zeros, mask_ones);</span><br><span class="line">    mask_operation = _cs149_mask_not(mask_operation);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 循环乘</span></span><br><span class="line">    <span class="keyword">while</span> (_cs149_cntbits(mask_operation)) &#123;</span><br><span class="line">      _cs149_vmult_float(v_output, v_output, v_values, mask_operation);</span><br><span class="line">      _cs149_vsub_int(v_exponents, v_exponents, v_int_ones, mask_operation);</span><br><span class="line">      _cs149_veq_int(mask_operation, v_exponents, v_int_zeros, mask_ones);</span><br><span class="line">      mask_operation = _cs149_mask_not(mask_operation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// clamp value to 9.999</span></span><br><span class="line">    __cs149_vec_float v_clamp = _cs149_vset_float(<span class="number">9.999999f</span>);</span><br><span class="line">    __cs149_mask is_clamp;</span><br><span class="line">    _cs149_vgt_float(is_clamp, v_output, v_clamp, mask_ones);</span><br><span class="line">    _cs149_vmove_float(v_output, v_clamp, is_clamp);</span><br><span class="line">    <span class="comment">// construct output</span></span><br><span class="line">    _cs149_vstore_float(output + offset, v_output, mask_ones);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）</p>
<p>执行.&#x2F;myexp -s 10000  （Exp的长度为 10000）</p>
<p>向量利用率 随 VECTOR_WIDTH 变化图表：</p>
<table>
<thead>
<tr>
<th>向量宽度</th>
<th>2</th>
<th>4</th>
<th>8</th>
<th>16</th>
</tr>
</thead>
<tbody><tr>
<td>向量利用率</td>
<td>90.1%</td>
<td>85.8%</td>
<td>83.7%</td>
<td>82.6%</td>
</tr>
</tbody></table>
<p>向量利用率随向量宽度的增加而减小。</p>
<p>原因:</p>
<p>寄存器资源限制：在 SIMD 编程中,每个处理器核心都有固定数量的向量寄存器。当向量宽度增加时,需要更多的寄存器资源来存储更宽的向量。如果寄存器资源不足,就会限制向量指令的并行度,降低向量利用率。<br>内存访问效率下降：较宽的向量需要更多的内存带宽来加载和存储数据。如果内存带宽不足,就会导致内存访问延迟,降低向量指令的吞吐量,从而降低向量利用率。<br>控制流复杂度增加：宽向量可能需要更复杂的控制流和地址计算逻辑,增加了指令派发和执行的开销,降低了向量利用率。<br>不可向量化的代码比例增加：当向量宽度增加时,通常会有更多的不可向量化代码(如边界条件处理、数据依赖等),占用了处理器资源,降低了向量利用率。</p>
<h2 id="程序-3：使用-ISPC-并行生成分形图像（20-分）"><a href="#程序-3：使用-ISPC-并行生成分形图像（20-分）" class="headerlink" title="程序 3：使用 ISPC 并行生成分形图像（20 分）"></a>程序 3：使用 ISPC 并行生成分形图像（20 分）</h2><p>既然你已经熟悉了 SIMD 执行，我们将返回到并行 Mandelbrot 分形图像生成（类似于程序 1）。和程序 1 一样，程序 3 计算 Mandelbrot 分形图像，但它通过利用 CPU 的四个核心和每个核心内的 SIMD 执行单元，实现了更大的加速效果。</p>
<p>在程序 1 中，你通过为系统中的每个处理核心创建一个线程来并行化图像生成。然后，你将部分计算分配给这些并发执行的线程。（由于在程序 1 中线程与处理核心是一对一的，因此你实际上是显式地将工作分配给核心。）程序 3 使用 ISPC 语言构造来描述<em>独立计算</em>，而不是指定并发执行线程的具体映射。这些计算可以并行执行，而不会违反程序的正确性（实际上它们确实会并行执行！）。在 Mandelbrot 图像的情况下，计算每个像素的值是一个独立的计算。通过这些信息，ISPC 编译器和运行时系统负责生成一个程序，该程序尽可能高效地利用 CPU 的并行执行资源集合。</p>
<p>你需要对由 C++ 和 ISPC 组合编写的程序 3 进行一个简单的修复（错误导致性能问题，而不是正确性问题）。通过正确的修复，你应该会观察到性能比原始的 <code>mandelbrotSerial()</code> 串行 Mandelbrot 实现高出 32 倍以上。</p>
<h3 id="程序-3，第-1-部分：一些-ISPC-基础知识（20-分中的-10-分）"><a href="#程序-3，第-1-部分：一些-ISPC-基础知识（20-分中的-10-分）" class="headerlink" title="程序 3，第 1 部分：一些 ISPC 基础知识（20 分中的 10 分）"></a>程序 3，第 1 部分：一些 ISPC 基础知识（20 分中的 10 分）</h3><p>阅读 ISPC 代码时，你必须记住，尽管代码看起来很像 C&#x2F;C++ 代码，但 ISPC 执行模型与标准的 C&#x2F;C++ 不同。与 C 相比，ISPC 程序的多个程序实例始终在 CPU 的 SIMD 执行单元上并行执行。并发执行的程序实例数量由编译器确定（并为底层机器专门选择）。这个并发实例数可以通过内置变量 <code>programCount</code> 获得。ISPC 代码可以通过内置的 <code>programIndex</code> 引用其自己的程序实例标识符。因此，从 C 代码调用 ISPC 函数可以被认为是生成了一组并发的 ISPC 程序实例（在 ISPC 文档中称为 gang）。这组实例运行到完成，然后控制权返回给调用的 C 代码。</p>
<p><strong>停下。这是你友好的导师。请再读一遍上段文字。相信我。</strong></p>
<p>作为示例，以下程序使用常规 C 代码和 ISPC 代码的组合来相加两个 1024 元素的向量。正如我们在课堂上讨论的那样，由于 gang 中的每个实例都是独立的，并且执行完全相同的程序逻辑，因此可以通过使用 SIMD 指令实现加速。</p>
<p>下面是一个简单的 ISPC 程序。以下 C 代码将调用以下 ISPC 代码：</p>
<pre><code>------------------------------------------------------------------------
C 程序代码: myprogram.cpp
------------------------------------------------------------------------
const int TOTAL_VALUES = 1024;
float a[TOTAL_VALUES];
float b[TOTAL_VALUES];
float c[TOTAL_VALUES]

// 初始化数组 a 和 b。

sum(TOTAL_VALUES, a, b, c);

// 在 sum 返回后，a + b 的结果存储在 c 中。
</code></pre>
<p>对应的 ISPC 代码：</p>
<pre><code>------------------------------------------------------------------------
ISPC 代码: myprogram.ispc
------------------------------------------------------------------------
export sum(uniform int N, uniform float* a, uniform float* b, uniform float* c)
&#123;
  // 假设 programCount 可以整除 N。
  for (int i=0; i&lt;N; i+=programCount)
  &#123;
    c[programIndex + i] = a[programIndex + i] + b[programIndex + i];
  &#125;
&#125;
</code></pre>
<p>上述 ISPC 程序代码在程序实例之间交错处理数组元素。注意与程序 1 的相似之处，在程序 1 中，你静态地将图像部分分配给线程。</p>
<p>然而，与其考虑如何在程序实例之间划分工作（即如何将工作映射到执行单元），通常更方便、更强大的是仅关注问题的独立部分划分。ISPC 的 <code>foreach</code> 构造提供了一种表达问题分解的机制。下面，ISPC 函数 <code>sum2</code> 中的 <code>foreach</code> 循环定义了一个迭代空间，其中所有迭代都是独立的，因此可以按任何顺序执行。ISPC 处理将循环迭代分配给并发程序实例。下面是 <code>sum</code> 和 <code>sum2</code> 之间的区别，尽管微妙但非常重要。<code>sum</code> 是命令式的：它描述了如何将工作映射到并发实例。下面的示例是声明式的：它仅指定要执行的工作集。</p>
<pre><code>-------------------------------------------------------------------------
ISPC 代码:
-------------------------------------------------------------------------
export sum2(uniform int N, uniform float* a, uniform float* b, uniform float* c)
&#123;
  foreach (i = 0 ... N)
  &#123;
    c[i] = a[i] + b[i];
  &#125;
&#125;
</code></pre>
<p>在继续之前，建议你通过阅读 ISPC 示例演练来熟悉 ISPC 语言构造，该演练可在 <a target="_blank" rel="noopener" href="http://ispc.github.io/example.html">http://ispc.github.io/example.html</a> 找到。演练中的示例程序与 <code>mandelbrot.ispc</code> 中 <code>mandelbrot_ispc()</code> 的程序 3 实现几乎完全相同。在作业代码中，我们更改了 <code>foreach</code> 循环的界限，以便实现更直接的实现。</p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li>编译并运行 mandelbrot ispc 程序。<strong>ISPC 编译器当前配置为发出 8 宽 AVX2 向量指令。</strong> 鉴于你对这些 CPU 的了解，你期望的最大加速是多少？为什么你观察到的数字可能低于这个理想值？（提示：考虑你正在执行的计算的特征？描述图像的哪些部分对 SIMD 执行提出了挑战？比较渲染 Mandelbrot 集的不同视图的性能可能有助于确认你的假设。）</li>
</ol>
<p>我们提醒你，对于本节描述的代码，ISPC 编译器将程序实例的 gang 映射到单个核心上执行的 SIMD 指令。这种并行化方案不同于程序 1，其中通过在多个核心上运行线程来实现加速。</p>
<p>如果你查阅有关 myth 机器中 CPU 的详细技术资料，你会发现关于每个时钟周期可以运行多少标量和向量指令的规则非常复杂。对于本作业，你可以假设浮点数学的标量执行单元和 8 宽向量执行单元数量大致相同。</p>
<h5 id="我的实现-2"><a href="#我的实现-2" class="headerlink" title="我的实现"></a>我的实现</h5><p>（1）ISPC 编译器被配置为发出 8 宽 AVX2 向量指令。这意味着它可以同时对 8 个浮点数执行相同的操作,从而理论上可以获得 8 倍的加速。</p>
<p>编译并运行 mandelbrot ispc 程序</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527105414278.png" alt="image-20240527105414278.png"></p>
<p>图一加速比为3.54，图二加速比为2.86</p>
<p>低于理想值的原因：</p>
<p>这是由于同一条AVX2指令的车道上的不平衡计算造成的，即图片中的黑白过渡部分。比较两个视图，可能会在视图2中发现更多的“白色分支”，这会导致更差的性能。</p>
<h3 id="程序-3，第-2-部分：ISPC-任务（20-分中的-10-分）"><a href="#程序-3，第-2-部分：ISPC-任务（20-分中的-10-分）" class="headerlink" title="程序 3，第 2 部分：ISPC 任务（20 分中的 10 分）"></a>程序 3，第 2 部分：ISPC 任务（20 分中的 10 分）</h3><p>ISPC 的 SPMD 执行模型和类似 <code>foreach</code> 的机制促进了利用 SIMD 处理的程序的创建。该语言还提供了一种额外的机制，利用多个核心进行 ISPC 计算。该机制是启动 _ISPC 任务_。</p>
<p>参见函数 <code>mandelbrot_ispc_withtasks</code> 中的 <code>launch[2]</code> 命令。该命令启动了两个任务。每个任务定义了一个将由一组 ISPC 程序实例执行的计算。根据函数 <code>mandelbrot_ispc_task</code>，每个任务计算最终图像的一个区域。类似于 <code>foreach</code> 构造定义的循环迭代可以按任何顺序执行（并且可以由 ISPC 程序实例并行处理），由此启动的任务可以按任何顺序处理（并且可以在不同的 CPU 核心上并行处理）。</p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li>使用参数 <code>--tasks</code> 运行 <code>mandelbrot_ispc</code>。在视图 1 上你观察到的加速是多少？与未将计算划分为任务的 <code>mandelbrot_ispc</code> 版本相比，加速是多少？</li>
<li>通过更改代码中 <code>mandelbrot_ispc_withtasks()</code> 函数内的任务数，有一种简单的方法可以提高 <code>mandelbrot_ispc --tasks</code> 的性能。通过仅更改 <code>mandelbrot_ispc_withtasks()</code> 函数中的代码，你应该能够实现比串行版本的代码超过 32 倍的性能。你是如何确定要创建多少个任务的？为什么你选择的数字效果最好？</li>
<li><em>额外奖励：（2 分）</em> 线程抽象（在程序 1 中使用）和 ISPC 任务抽象之间有什么区别？（创建&#x2F;连接）机制和（启动&#x2F;同步）机制在语义上有一些明显的区别，但这些区别的影响更加微妙。以下是指导你回答的一个思维实验：当你启动 10,000 个 ISPC 任务时会发生什么？当你启动 10,000 个线程时会发生什么？（对于此思维实验，请在一般情况下讨论——即不要将讨论与给定的 Mandelbrot 程序联系起来。）</li>
</ol>
<p>_聪明学生的问题_：嘿，等等！为什么 ISPC 系统有两种不同的机制（<code>foreach</code> 和 <code>launch</code>）来表达独立的、可并行化的工作？系统不能只是将 <code>foreach</code> 的许多迭代划分到所有核心，并且还发出适当的核心 SIMD 代码吗？</p>
<p>_回答_：好问题！答案有很多种可能。来参加我的办公时间讨论吧。</p>
<h5 id="我的实现-3"><a href="#我的实现-3" class="headerlink" title="我的实现"></a>我的实现</h5><p>（1）使用参数 –task 运行：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527105821026.png" alt="image-20240527105821026.png"></p>
<p>未划分：加速比为3.54</p>
<p>划分后：加速比为6.94</p>
<p>（2）</p>
<p>我根据机器可以提供的最大超线程数来确定任务的数量。我的电脑可以支持16个超线程，所以取任务数为16可以取得最好的成绩。</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527111736502.png" alt="image-20240527111736502.png"></p>
<h2 id="程序-4：迭代-sqrt（15-分）"><a href="#程序-4：迭代-sqrt（15-分）" class="headerlink" title="程序 4：迭代 sqrt（15 分）"></a>程序 4：迭代 <code>sqrt</code>（15 分）</h2><p>程序 4 是一个 ISPC 程序，它计算 2000 万个在 0 到 3 之间的随机数的平方根。它使用一种快速的迭代实现的平方根方法，使用 Newton 方法来求解方程 ${\frac{1}{x^2}} - S &#x3D; 0$。该实现使用 1.0 作为初始猜测值。下图显示了对于（0-3）范围内的值，<code>sqrt</code> 收敛到准确解所需的迭代次数。（对于此范围之外的输入值，实现不收敛）。注意收敛速度取决于初始猜测的准确性。</p>
<p>注意：这个问题是一个复习，以双重检查你的理解，因为它涵盖了与程序 2 和程序 3 类似的概念。</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527144036048.png" alt="image-20240527144036048.png"></p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li>构建并运行 <code>sqrt</code>。报告单个 CPU 核心（无任务）和使用所有核心（有任务）时的 ISPC 实现加速。 SIMD 并行化的加速是多少？多核心并行化的加速是多少？</li>
<li>修改数组值的内容以提高 ISPC 实现的相对加速。构造一个特定输入，__最大化相对于代码的串行版本的加速__，并报告实现的加速结果（对于有任务和无任务的 ISPC 实现）。你的修改是否提高了 SIMD 加速？是否提高了多核心加速（即从无任务的 ISPC 到有任务的 ISPC 的好处）？请解释为什么。</li>
<li>构造一个特定的 <code>sqrt</code> 输入，__最小化 ISPC（无任务）相对于代码的串行版本的加速__。描述此输入，描述你选择它的原因，并报告 ISPC 实现的相对性能。效率下降的原因是什么？<br>__(请记住我们使用的是 <code>--target=avx2</code> 选项为 ISPC 生成 8 宽 SIMD 指令)__。</li>
<li><em>额外奖励：（最多 2 分）</em> 使用 AVX2 内联函数手动编写你自己的 <code>sqrt</code> 函数版本。为了获得奖励，你的实现应接近 ISPC 生成的二进制文件的速度（或更快）。你可能会发现 <a target="_blank" rel="noopener" href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/">Intel 内联函数指南</a> 非常有帮助。</li>
</ol>
<h5 id="我的实现-4"><a href="#我的实现-4" class="headerlink" title="我的实现"></a>我的实现</h5><p>（1）运行代码：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527112403331.png" alt="image-20240527112403331.png"></p>
<p>无任务时ISPC： 3.75加速比</p>
<p>有任务时ISPC： 45.53加速比</p>
<p>SIMD并行化带来了3.75倍的加速，多核并行化带来了12.14倍的加速。</p>
<p>（2）我构造了一个所有元素都等于2.998的数组。由于所有元素都是相等的，因此每个通道都需要相同的迭代，从而导致SIMD并行化中的无掩码。此外，2.998需要更多的计算，这将使CPU饱和，并补偿任务版本中的多线程开销。</p>
<p>运行代码结果：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527114031726.png" alt="image-20240527114031726.png"></p>
<p>我从ISPC获得了4.15倍的加速，从任务ISPC获得了41.96倍的加速。</p>
<p>(3)我构造了一个数组，除了索引为8的倍数等于2.998的元素外，所有元素都等于1。</p>
<p>运行结果：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527114509938.png" alt="image-20240527114509938.png"></p>
<p>对于这个输入，我从ISPC获得了0.55倍的加速，这比串行情况更糟糕。</p>
<h2 id="程序-5：BLAS-的-saxpy（10-分）"><a href="#程序-5：BLAS-的-saxpy（10-分）" class="headerlink" title="程序 5：BLAS 的 saxpy（10 分）"></a>程序 5：BLAS 的 <code>saxpy</code>（10 分）</h2><p>程序 5 是 BLAS（Basic Linear Algebra Subproblems）库中 <code>saxpy</code> 例程的实现，在许多系统上被广泛使用（并进行了大量优化）。<code>saxpy</code> 计算简单的操作 <code>result = scale*X+Y</code>，其中 <code>X</code>、<code>Y</code> 和 <code>result</code> 是 <code>N</code> 元素的向量（在程序 5 中，<code>N</code> &#x3D; 2000 万），而 <code>scale</code> 是一个标量。注意，<code>saxpy</code> 对于每三个元素使用的操作是两个数学运算（一个乘法，一个加法）。<code>saxpy</code> 是一个 <em>可轻松并行化的计算</em>，具有可预测的、规则的数据访问和可预测的执行成本。</p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li>编译并运行 <code>saxpy</code>。程序将报告使用 ISPC（无任务）和 ISPC（有任务）实现的 saxpy 的性能。你观察到使用带有任务的 ISPC 的加速是多少？解释该程序的性能。你认为它可以显著改进吗？（例如，你能重写代码以实现近似线性的加速吗？是或否？请解释你的答案。）</li>
<li><strong>额外学分：（1 分）</strong> 请注意，<code>main.cpp</code> 中计算的总内存带宽是 <code>TOTAL_BYTES = 4 * N * sizeof(float);</code>。即使 <code>saxpy</code> 从 X 加载一个元素，从 Y 加载一个元素，并将一个元素写入 <code>result</code>，乘以 4 也是正确的。为什么会这样？（提示，思考 CPU 缓存的工作原理。）</li>
<li><strong>额外学分：（每种情况视情况而定）</strong> 提高 <code>saxpy</code> 的性能。我们希望这里的加速比大约为 2.1 倍或更高（即 $\frac{旧运行时}{新运行时} &gt;&#x3D; 2.1$）。请解释你是如何达到解决方案的，以及你的最终解决方案是什么，以及相关的加速。此过程的撰写应描述一系列步骤。我们期望得到的是”我测量了……，这让我相信 X。所以为了改进，我尝试了……，导致了速度提升&#x2F;减慢……”的形式。</li>
</ol>
<p>注意：一些学生在过去的问题中陷入了困境（想得太多）。我们期望得到一个简单的答案，但是从运行这个问题的结果中可能会引发更多的问题。我们鼓励你与工作人员交流。</p>
<h5 id="我的实现-5"><a href="#我的实现-5" class="headerlink" title="我的实现"></a>我的实现</h5><p>（1）编译运行：</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527114900161.png" alt="image-20240527114900161.png"></p>
<p>通过使用任务，我只获得了1.78倍的加速。由于这个程序需要很多内存访问，所以它受到内存带宽的限制。我认为它不可能有实质性的改善。</p>
<p>（2）当程序写入result的一个元素时，它首先将包含该元素的缓存行取出到缓存中。这需要一个内存操作。然后当这个缓存行不需要时，它将从缓存中取出来，这需要另一个内存操作。</p>
<h2 id="程序-6：加速-K-Means（15-分）"><a href="#程序-6：加速-K-Means（15-分）" class="headerlink" title="程序 6：加速 K-Means（15 分）"></a>程序 6：加速 <code>K-Means</code>（15 分）</h2><p>程序 6 使用 K-Means 数据聚类算法（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/K-means_clustering">维基百科</a>，<a target="_blank" rel="noopener" href="https://stanford.edu/~cpiech/cs221/handouts/kmeans.html">CS 221 手册</a>）对一百万个数据点进行聚类。如果你对算法不熟悉，不用担心！对于这个练习来说，具体内容并不重要，但是在高层次上，给定 K 个起始点（聚类中心），该算法迭代地更新聚类中心直到满足收敛条件。结果可以在下面的图像中看到，显示了程序在算法开始和结束时的状态，其中红色星号是聚类中心，数据点颜色对应于聚类分配。</p>
<p><img src="/2024/05/27/%E5%B9%B6%E8%A1%8C%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/image-20240527144053550.png" alt="image-20240527144053550.png"></p>
<p>在起始代码中，你已经得到了 K-means 算法的正确实现，但在当前状态下，它的速度不如我们希望的快。这就是你的任务！你的工作是弄清楚<strong>代码中</strong>哪里需要改进以及<strong>如何</strong>改进。你将练习的关键技能是__定位性能瓶颈__。我们不会告诉你在代码中应该查找哪里。你需要自己找到。你的第一个想法应该是……代码中的时间花在哪里？你应该在源代码中插入计时代码来进行测量。根据这些测量结果，你应该关注花费大部分运行时间的代码部分，并仔细了解它，以确定是否有方法可以加速它。</p>
<p><strong>你需要做的是：</strong></p>
<ol>
<li><p>使用命令 <code>ln -s /afs/ir.stanford.edu/class/cs149/data/data.dat ./data.dat</code> 在当前目录中创建到数据集的符号链接（确保你在 <code>prog6_kmeans</code> 目录中）。这是一个大文件（~800MB），所以这是访问它的首选方式。但是，如果你想要一个本地副本，你可以在个人计算机上运行这个命令 <code>scp [Your SUNetID]@myth[51-66].stanford.edu:/afs/ir.stanford.edu/class/cs149/data/data.dat ./data.dat</code>。一旦你有了数据，编译并运行 <code>kmeans</code>（第一次尝试加载数据可能需要更长的时间）。程序将报告算法在数据上的总运行时间。</p>
</li>
<li><p>运行 <code>pip install -r requirements.txt</code> 下载必要的绘图包。接下来，尝试运行 <code>python3 plot.py</code>，它将从运行 <code>kmeans</code> 生成的日志（”start.log” 和 “end.log”）生成文件 “start.png” 和 “end.png”。这些文件将在当前目录中，并且应该与上面的图像类似。只要聚类看起来“合理”（使用起始代码生成的图像作为参考），并且大多数数据点似乎被分配给最近的聚类中心，代码就保持正确。</p>
</li>
<li><p>利用 <code>common/CycleTimer.h</code> 中的计时函数确定代码中存在哪些性能瓶颈。你需要调用 <code>CycleTimer::currentSeconds()</code>，它返回当前时间（以秒为单位）作为浮点数。在代码的哪些部分花费了大部分时间？</p>
</li>
<li><p>根据前一步的发现改进实现。我们希望实现的加速比约为 2.1 倍或更高（即 $\frac{旧运行时}{新运行时} &gt;&#x3D; 2.1$）。请解释你是如何达到解决方案的，以及你的最终解决方案是什么，以及相关的加速。此过程的撰写应描述一系列步骤。我们期望得到的是“我测量了……，这让我相信 X。所以为了改进，我尝试了……，导致了速度提升&#x2F;减慢……”的形式。</p>
</li>
</ol>
<p>约束：</p>
<ul>
<li>你只能修改 <code>kmeansThread.cpp</code> 中的代码。你不允许修改 <code>stoppingConditionMet</code> 函数，也不能改变 <code>kMeansThread</code> 的接口，但任何其他操作都可以（例如，你可以向 <code>WorkerArgs</code> 结构体添加新成员，重写函数，分配新数组等）。然而…</li>
<li><strong>确保不改变实现的功能！如果算法不收敛或从运行 <code>python3 plot.py</code> 生成的结果看起来与起始代码生成的结果不同，那么就有问题！</strong> 例如，你不能简单地删除主“while”循环或更改 <code>dist</code> 函数的语义，因为这将产生不正确的结果。</li>
<li><strong>此问题不应需要大量编码。我们的解决方案修改&#x2F;添加了大约 20-25 行代码。</strong></li>
<li>一旦你使用计时器定位了热点，为了改进代码，请确保你理解了 K、M 和 N 的相对大小。</li>
<li>试着优先考虑具有高回报潜力的代码改进，并思考问题中可用的不同并行性轴，以及如何利用它们。</li>
</ul>
<p><strong>这个问题的目标是让你练习如何对性能导向的程序进行性能分析和调试。即使你没有达到性能目标，如果你在写作中展示出良好&#x2F;周到的调试技能，你仍然会得到大部分的分数。</strong></p>
<p><strong>我的实现</strong></p>
<p>（1）没有数据集，写不了…………………………….</p>
<h2 id="ARM-based-Macs-的情况"><a href="#ARM-based-Macs-的情况" class="headerlink" title="ARM-based Macs 的情况"></a>ARM-based Macs 的情况</h2><p>对于那些有新的基于 ARM 的苹果笔记本的人，尝试将 ISPC 编译目标更改为 <code>neon-i32x8</code>，并将编译架构更改为 <code>aarch64</code>，在程序 3、4 和 5 中。其他程序只使用 GCC，并应该生成正确的目标。生成一个关于新的基于 ARM 的苹果笔记本上各种程序性能的报告。工作人员对你的发现很感兴趣。你观察到了 SIMD 执行的加速比是多少？那些没有现代 Macbook 的人可以尝试在像 AWS 这样的云提供商上使用基于 ARM 的服务器，尽管这还没有经过工作人员的测试。</p>
<h2 id="对于好奇的人（强烈推荐）"><a href="#对于好奇的人（强烈推荐）" class="headerlink" title="对于好奇的人（强烈推荐）"></a>对于好奇的人（强烈推荐）</h2><p>想了解 ISPC 及其创建过程吗？ISPC 的两位创始人之一 Matt Pharr 写了一篇关于其发展历程的 __令人惊叹的博文__，名为 <a target="_blank" rel="noopener" href="https://pharr.org/matt/blog/2018/04/30/ispc-all">The story of ispc</a>。它真正触及了许多并行系统设计的问题——特别是有限范围与通用编程语言的价值。在我看来，这对于 CS149 的学生来说是必读的！</p>
<h2 id="提交说明"><a href="#提交说明" class="headerlink" title="提交说明"></a>提交说明</h2><p>提交将通过 <a target="_blank" rel="noopener" href="https://www.gradescope.com/">Gradescope</a> 进行。每个小组只需提交一次。但是，请确保将你的合作伙伴的姓名添加到 Gradescope 提交中。在 Gradescope 上，有两个地方需要提交文件：<code>Assignment 1 (Write-Up)</code> 和 <code>Assignment 1 (Code)</code>。</p>
<p>请将以下内容放在 <code>Assignment 1 (Write-Up)</code> 中：</p>
<ul>
<li>你的撰写内容，保存为 <code>writeup.pdf</code>。请确保文档中包含两位组员的姓名和 SUNet ID（如果是两人组）。</li>
</ul>
<p>请将以下内容放在 <code>Assignment 1 (Code)</code> 中：</p>
<ul>
<li>Program 2 中 <code>main.cpp</code> 的实现，保存为 <code>prob2.cpp</code>。</li>
<li>Program 6 中 <code>kmeansThread.cpp</code> 的实现，保存为 <code>prob6.cpp</code>。</li>
<li>任何额外的代码，例如因为你尝试了额外的信用分。</li>
</ul>

      </section>

      
      
        <nav class="article-nav">
          
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
      <div class="card-cover" background-image-lazy data-img="/img/1680584184078.png"></div>
    
    <div class="card-text">
      
        <a href="/2023/09/25/wangchun1/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">网络存储lab1</h2>
        </a>
      
      <div class="card-text--row">Older</div>
    </div>
  </article>
</div>
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  
    <div class="valine-container comments-container content-padding--primary soft-size--large soft-style--box">
      <div id="valine_thread" class="valine-thread"></div>
    </div>
    <script type="text/javascript" src="//unpkg.com/leancloud-storage@3.15.0/dist/av-min.js"></script>
    <script type="text/javascript" src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <script type="text/javascript">
      new Valine({
        el: "#valine_thread",
        appId: "PFkWNl6juIH50dmKXqUrRKnu-gzGzoHsz",
        appKey: "XLgzyVdb5h7y6kQ4YOIRcQRO",
        placeholder: "随便说点什么叭～",
        avatar: "mp",
        pageSize: 10,
        lang: "zh-cn",
        visitor: true,
        recordIP: true,
        enableQQ: false,
        meta: ['nick', 'mail', 'link'],
        requiredFields: ['nick'],
        
        // Bilibili 表情包插件
        // 设置 Bilibili 表情包地址
        emojiCDN: '//i0.hdslb.com/bfs/emote/', 
        // 表情 title 和图片映射
        emojiMaps: {
            // 小黄脸
            "2023": "fa6dda8b876ed38609de38aa604be5ad109b8591.png",
            "足球": "f9157d9fa5ac3b8339cb8a8b7ad70eb40d4113c9.png",
            "脱单doge": "bf7e00ecab02171f8461ee8cf439c73db9797748.png",
            "微笑": "685612eadc33f6bc233776c6241813385844f182.png",
            "口罩": "3ad2f66b151496d2a5fb0a8ea75f32265d778dd3.png",
            "doge": "3087d273a78ccaff4bb1e9972e2ba2a7583c9f11.png",
            "妙啊": "b4cb77159d58614a9b787b91b1cd22a81f383535.png",
            "OK": "4683fd9ffc925fa6423110979d7dcac5eda297f4.png",
            "星星眼": "63c9d1a31c0da745b61cdb35e0ecb28635675db2.png",
            "辣眼睛": "35d62c496d1e4ea9e091243fa812866f5fecc101.png",
            "吃瓜": "4191ce3c44c2b3df8fd97c33f85d3ab15f4f3c84.png",
            "滑稽": "d15121545a99ac46774f1f4465b895fe2d1411c3.png",
            "呲牙": "b5a5898491944a4268360f2e7a84623149672eb6.png",
            "打call": "431432c43da3ee5aab5b0e4f8931953e649e9975.png",
            "歪嘴": "4384050fbab0586259acdd170b510fe262f08a17.png",
            "调皮": "8290b7308325e3179d2154327c85640af1528617.png",
            "2022": "a783df2ce72952c44004007462324bde4b092a0c.png",
            "虎年": "a062f5fa2bafe677e49b6963a2bbb11dd4fe1e11.png",
            "豹富": "3d1dbe52ea16e12ff7b1c371196f728a4097fb33.png",
            "嗑瓜子": "28a91da1685d90124cfeead74622e1ebb417c0eb.png",
            "笑哭": "c3043ba94babf824dea03ce500d0e73763bf4f40.png",
            "藏狐": "ba0937ef6f3ccca85e2e0047e6263f3b4da37201.png",
            "脸红": "0922c375da40e6b69002bd89b858572f424dcfca.png",
            "给心心": "1597302b98827463f5b75c7cac1f29ea6ce572c4.png",
            "嘟嘟": "abd7404537d8162720ccbba9e0a8cdf75547e07a.png",
            "哦呼": "362bded07ea5434886271d23fa25f5d85d8af06c.png",
            "喜欢": "8a10a4d73a89f665feff3d46ca56e83dc68f9eb8.png",
            "酸了": "92b1c8cbceea3ae0e8e32253ea414783e8ba7806.png",
            "嫌弃": "de4c0783aaa60ec03de0a2b90858927bfad7154b.png",
            "大哭": "2caafee2e5db4db72104650d87810cc2c123fc86.png",
            "害羞": "9d2ec4e1fbd6cb1b4d12d2bbbdd124ccb83ddfda.png",
            "疑惑": "b7840db4b1f9f4726b7cb23c0972720c1698d661.png",
            "喜极而泣": "485a7e0c01c2d70707daae53bee4a9e2e31ef1ed.png",
            "奸笑": "bb84906573472f0a84cebad1e9000eb6164a6f5a.png",
            "笑": "81edf17314cea3b48674312b4364df44d5c01f17.png",
            "偷笑": "6c49d226e76c42cd8002abc47b3112bc5a92f66a.png",
            "惊讶": "f8e9a59cad52ae1a19622805696a35f0a0d853f3.png",
            "捂脸": "6921bb43f0c634870b92f4a8ad41dada94a5296d.png",
            "阴险": "ba8d5f8e7d136d59aab52c40fd3b8a43419eb03c.png",
            "囧": "12e41d357a9807cc80ef1e1ed258127fcc791424.png",
            "呆": "33ad6000d9f9f168a0976bc60937786f239e5d8c.png",
            "抠鼻": "cb89184c97e3f6d50acfd7961c313ce50360d70f.png",
            "大笑": "ca94ad1c7e6dac895eb5b33b7836b634c614d1c0.png",
            "惊喜": "0afecaf3a3499479af946f29749e1a6c285b6f65.png",
            "无语": "44667b7d9349957e903b1b62cb91fb9b13720f04.png",
            "点赞": "1a67265993913f4c35d15a6028a30724e83e7d35.png",
            "鼓掌": "895d1fc616b4b6c830cf96012880818c0e1de00d.png",
            "尴尬": "cb321684ed5ce6eacdc2699092ab8fe7679e4fda.png",
            "灵魂出窍": "43d3db7d97343c01b47e22cfabeca84b4251f35a.png",
            "委屈": "d2f26cbdd6c96960320af03f5514c5b524990840.png",
            "傲娇": "010540d0f61220a0db4922e4a679a1d8eca94f4e.png",
            "疼": "905fd9a99ec316e353b9bd4ecd49a5f0a301eabf.png",
            "冷": "cb0ebbd0668640f07ebfc0e03f7a18a8cd00b4ed.png",
            "热": "4e58a2a6f5f1580ac33df2d2cf7ecad7d9ab3635.png",
            "生病": "0f25ce04ae1d7baf98650986454c634f6612cb76.png",
            "吓": "9c10c5ebc7bef27ec641b8a1877674e0c65fea5d.png",
            "吐": "06946bfe71ac48a6078a0b662181bb5cad09decc.png",
            "捂眼": "c5c6d6982e1e53e478daae554b239f2b227b172b.png",
            "嘘声": "e64af664d20716e090f10411496998095f62f844.png",
            "思考": "cfa9b7e89e4bfe04bbcd34ccb1b0df37f4fa905c.png",
            "再见": "fc510306bae26c9aec7e287cdf201ded27b065b9.png",
            "翻白眼": "eba54707c7168925b18f6f8b1f48d532fe08c2b1.png",
            "哈欠": "888d877729cbec444ddbd1cf4c9af155a7a06086.png",
            "奋斗": "bb2060c15dba7d3fd731c35079d1617f1afe3376.png",
            "墨镜": "3a03aebfc06339d86a68c2d893303b46f4b85771.png",
            "难过": "a651db36701610aa70a781fa98c07c9789b11543.png",
            "撇嘴": "531863568e5668c5ac181d395508a0eeb1f0cda4.png",
            "抓狂": "4c87afff88c22439c45b79e9d2035d21d5622eba.png",
            "生气": "3195714219c4b582a4fb02033dd1519913d0246d.png",
            "水稻": "d530fcaa5100ba12a17a79b55bad342d530c54e3.png",
            "奶茶干杯": "d5a491990be551ce69f9660da948050df4eab331.png",
            "汤圆": "93609633a9d194cf336687eb19c01dca95bde719.png",
            "锦鲤": "643d6c19c8164ffd89e3e9cdf093cf5d773d979c.png",
            "弹幕破百亿": "80891223ba023dff3141e377f4ea3b89918eb6a4.png",
            "福到了": "5de5373d354c373cf1617b6b836f3a8d53c5a655.png",
            "鸡腿": "c7860392815d345fa69c4f00ef18d67dccfbd574.png",
            "雪花": "a41813c4edf8782047e172c884ebd4507ce5e449.png",
            "视频卫星": "dce6fc7d6dfeafff01241924db60f8251cca5307.png",
            "干杯": "8da12d5f55a2c7e9778dcc05b40571979fe208e6.png",
            "黑洞": "e90ec4c799010f25391179118ccd9f66b3b279ba.png",
            "爱心": "ed04066ea7124106d17ffcaf75600700e5442f5c.png",
            "胜利": "b49fa9f4b1e7c3477918153b82c60b114d87347c.png",
            "加油": "c7aaeacb21e107292d3bb053e5abde4a4459ed30.png",
            "抱拳": "89516218158dbea18ab78e8873060bf95d33bbbe.png",
            "响指": "1b5c53cf14336903e1d2ae3527ca380a1256a077.png",
            "保佑": "fafe8d3de0dc139ebe995491d2dac458a865fb30.png",
            "福": "802429a301ac5b35a0480d9526a070ce67cd8097.png",
            "支持": "3c210366a5585706c09d4c686a9d942b39feeb50.png",
            "拥抱": "41780a4254750cdaaccb20735730a36044e98ef3.png",
            "跪了": "f2b3aee7e521de7799d4e3aa379b01be032698ac.png",
            "怪我咯": "07cc6077f7f7d75b8d2c722dd9d9828a9fb9e46d.png",
            "老鼠": "8e6fb491eb1bb0d5862e7ec8ccf9a3da12b6c155.png",
            "牛年": "9275275ff1f2659310648221107d20bc4970f106.png",
            "三星堆": "fc7dadaa6986e75b813aa26f3eff3281d5f1a6d1.png",
            "洛天依": "9fe06f3594d9afaf4ee2b74770f1c3086ae0ba11.png",
            "坎公骑冠剑_吃鸡": "c4248a7b6ab326d66c83fd1fb58f1a50f99df332.png",
            "坎公骑冠剑_钻石": "0b97c7e50e0cc963370e62fbb9b55f51bbe7f8ab.png",
            "坎公骑冠剑_无语": "80eba0ce64c3fc1279b4daede2f1979cb2380e78.png",
            "来古-沉思": "4ee07ff03266d62b246be0b950bebb2abf3d997c.png",
            "来古-呆滞": "9a70b365e523f2379f395031ceefcebb75a45903.png",
            "来古-疑问": "032fdc0d9d9fe6334776f6c39518a959b73b98f4.png",
            "来古-震撼": "8b40f228675602a317d32007de6b795c101135ec.png",
            "来古-注意": "4b671ba32a2581cf40e5cd41c67b111eb8010de0.png",
            "初音未来_大笑": "8e7f71cda83ce407b0684702983399f8ed982f17.png",
            "原神_哇": "8188ddf95bace929d382c7a83214afde79d83bfc.png",
            "原神_哼": "91ed33b74bc36873c3ac8b2648f70d7ab6d8ab78.png",
            "原神_嗯": "8b0a87e414f453a29730b6e0f45ca61f2f898688.png",
            "原神_欸嘿": "8fba438fcbe0550877b04efd768d857082307c5e.png",
            "原神_喝茶": "1de5789fbb3526ef7823c54db7081790a38e7044.png",
            "原神_生气": "90a38c34742899f8e84138ed55f56cad3ba611fb.png",
            "保卫萝卜_白眼": "9fce63f38288700bf7be84f3be336cf895ba0902.png",
            "保卫萝卜_笔芯": "5ff2ed5cb71b02010018cc5910ac7052a03769af.png",
            "保卫萝卜_哭哭": "7d249f7c990111d3e2982f7477af15b7eb29cbd9.png",
            "保卫萝卜_哇": "5f2370e561c32d841245f7b1aab2eef43aeb9544.png",
            "保卫萝卜_问号": "41eb93f09fc4a4d0692a310e8a1f85ba60e96060.png",
            "无悔华夏_不愧是你": "c58002c32ee78d45366e126f294cb3149dd64ac2.png",
            "无悔华夏_吃瓜": "273dcff577551bafff4f1eae18561f871e73a6ba.png",
            "无悔华夏_达咩": "cffab383f47bab7f6736ba9c8d6ac098113410d9.png",
            "无悔华夏_点赞": "b0f2e8db405ec667c3e6aaabd7c15155b6ea8710.png",
            "无悔华夏_好耶": "324cd79784aeb37dbf2f47f68bbe8ed5d01f975e.png",
            "奥比岛_搬砖": "1fab697214918d91087373a999cc7ef8040ddf85.png",
            "奥比岛_点赞": "fb0b476fe2ff30cd59385ea7d616627ac114161f.png",
            "奥比岛_击爪": "35bba1bb8f164c5e844155548438248e6eaa8382.png",
            "奥比岛_委屈": "fda155e7c33b40dbb94c24644e0635d47b6ef3cc.png",
            "奥比岛_喜欢": "ed64e0c81ee194138bd9df30c65077ed978fb88c.png",
            // tv_小电视
            "tv_白眼": "c1d59f439e379ee50eef488bcb5e5378e5044ea4.png",
            "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
            "tv_坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png",
            "tv_难过": "87f46748d3f142ebc6586ff58860d0e2fc8263ba.png",
            "tv_生气": "26702dcafdab5e8225b43ffd23c94ac1ff932654.png",
            "tv_委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
            "tv_斜眼笑": "911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png",
            "tv_呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
            "tv_发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
            "tv_惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
            "tv_呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png",
            "tv_思考": "90cf159733e558137ed20aa04d09964436f618a1.png",
            "tv_微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
            "tv_疑问": "0793d949b18d7be716078349c202c15ff166f314.png",
            "tv_大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
            "tv_鼓掌": "1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png",
            "tv_抠鼻": "c666f55e88d471e51bbd9fab9bb308110824a6eb.png",
            "tv_亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
            "tv_调皮": "b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png",
            "tv_笑哭": "1abc628f6d4f4caf9d0e7800878f4697abbc8273.png",
            "tv_晕": "5443c22b4d07fb1907ccc610c8e6db254f2461b7.png",
            "tv_点赞": "f85c354995bd99e28fc76c869bfe42ba6438eff4.png",
            "tv_害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
            "tv_睡着": "8b196675b53af58264f383c50ad0945048290b33.png",
            "tv_色": "61822c7e9aae5da76475e7892534545336b23a6f.png",
            "tv_吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png",
            "tv_无奈": "ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png",
            "tv_再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
            "tv_流汗": "cead1c351ab8d79e9f369605beb90148db0fbed3.png",
            "tv_偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png",
            "tv_抓狂": "fe31c08edad661d63762b04e17b8d5ae3c71a757.png",
            "tv_黑人问号": "45821a01f51bc867da9edbaa2e070410819a95b2.png",
            "tv_困": "241ee304e44c0af029adceb294399391e4737ef2.png",
            "tv_打脸": "56ab10b624063e966bfcb76ea5dc4794d87dfd47.png",
            "tv_闭嘴": "c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png",
            "tv_鄙视": "6e72339f346a692a495b123174b49e4e8e781303.png",
            "tv_腼腆": "89712c0d4af73e67f89e35cbc518420380a7f6f4.png",
            "tv_馋": "fc7e829b845c43c623c8b490ee3602b7f0e76a31.png",
            "tv_可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
            "tv_发财": "34db290afd2963723c6eb3c4560667db7253a21a.png",
            "tv_生病": "8b0ec90e6b86771092a498c54f09fc94621c1900.png",
            "tv_流鼻血": "c32d39db2737f89b904ca32700d140a9241b0767.png",
            "tv_尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
            "tv_大佬": "093c1e2c490161aca397afc45573c877cdead616.png",
            "tv_流泪": "7e71cde7858f0cd50d74b0264aa26db612a8a167.png",
            "tv_冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
            "tv_皱眉": "72ccad6679fea0d14cce648b4d818e09b8ffea2d.png",
            "tv_鬼脸": "0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png",
            "tv_调侃": "4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png",
            "tv_目瞪口呆": "0b8cb81a68de5d5365212c99375e7ace3e7891b7.png",
            // ... 更多表情
        }
        
      });
    </script>
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="/img/avatar.jpg" class="soft-size--round soft-style--box" alt="Morty">
    
    
      <h2>Morty</h2>
    
    
      <p>我阐释你的梦</p>
    

    <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>4</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        2
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        4
      </div>
    </div>
  </div>
</section>

      
<section class="widget-toc widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-toc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M134.50666666 767.46666668H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.23999999v50.13333333c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H134.50666666c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.13333333c0.10666668-27.73333333 22.50666668-50.24000001 50.24000001-50.24000001zM84.37333332 541.65333333h326.18666669c27.73333333 0 50.24000001 22.39999999 50.23999999 50.13333334v50.24000001c0 27.73333333-22.50666668 50.24000001-50.24000002 50.23999999H84.37333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.23999999v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333334zM134.50666666 315.83999999H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.24000001v50.24000001c0 27.73333333-22.50666668 50.13333334-50.24000001 50.13333333H134.50666666c-27.73333333 0-50.24000001-22.39999999-50.23999999-50.13333333v-50.24000001c0.10666668-27.84000001 22.50666668-50.24000001 50.24000001-50.23999999zM209.81333332 89.91999999h326.18666671c27.73333333 0 50.24000001 22.39999999 50.23999997 50.13333335v50.23999999c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H209.81333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333333zM692.05333333 623.36l274.66666669 176.00000002c23.36000001 14.93333333 30.08 45.97333334 15.14666666 69.33333332L954.77333334 910.93333333c-14.93333333 23.25333334-45.97333334 30.08-69.33333335 15.14666667l-274.66666666-176c-23.36000001-14.93333333-30.08-45.97333334-15.14666667-69.33333333l27.09333334-42.24000001c14.93333333-23.36000001 46.08000001-30.08 69.33333333-15.14666666z" fill="currentColor"></path>
</svg>
    <span>TOC</span>
  </div>
  <div class="widget-body">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">环境设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F1%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E5%B9%B6%E8%A1%8C%E7%94%9F%E6%88%90%E5%88%86%E5%BD%A2%EF%BC%8820%E5%88%86%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">程序1：使用线程并行生成分形（20分）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F2%EF%BC%9A%E4%BD%BF%E7%94%A8SIMD%E5%86%85%E5%9C%A8%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E5%90%91%E9%87%8F%E5%8C%96%E4%BB%A3%E7%A0%81%EF%BC%8820%E5%88%86%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">程序2：使用SIMD内在函数进行向量化代码（20分）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F-3%EF%BC%9A%E4%BD%BF%E7%94%A8-ISPC-%E5%B9%B6%E8%A1%8C%E7%94%9F%E6%88%90%E5%88%86%E5%BD%A2%E5%9B%BE%E5%83%8F%EF%BC%8820-%E5%88%86%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">程序 3：使用 ISPC 并行生成分形图像（20 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F-3%EF%BC%8C%E7%AC%AC-1-%E9%83%A8%E5%88%86%EF%BC%9A%E4%B8%80%E4%BA%9B-ISPC-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%8820-%E5%88%86%E4%B8%AD%E7%9A%84-10-%E5%88%86%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">程序 3，第 1 部分：一些 ISPC 基础知识（20 分中的 10 分）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F-3%EF%BC%8C%E7%AC%AC-2-%E9%83%A8%E5%88%86%EF%BC%9AISPC-%E4%BB%BB%E5%8A%A1%EF%BC%8820-%E5%88%86%E4%B8%AD%E7%9A%84-10-%E5%88%86%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">程序 3，第 2 部分：ISPC 任务（20 分中的 10 分）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F-4%EF%BC%9A%E8%BF%AD%E4%BB%A3-sqrt%EF%BC%8815-%E5%88%86%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">程序 4：迭代 sqrt（15 分）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F-5%EF%BC%9ABLAS-%E7%9A%84-saxpy%EF%BC%8810-%E5%88%86%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">程序 5：BLAS 的 saxpy（10 分）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F-6%EF%BC%9A%E5%8A%A0%E9%80%9F-K-Means%EF%BC%8815-%E5%88%86%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">程序 6：加速 K-Means（15 分）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARM-based-Macs-%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">9.</span> <span class="toc-text">ARM-based Macs 的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%A5%BD%E5%A5%87%E7%9A%84%E4%BA%BA%EF%BC%88%E5%BC%BA%E7%83%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">对于好奇的人（强烈推荐）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E8%AF%B4%E6%98%8E"><span class="toc-number">11.</span> <span class="toc-text">提交说明</span></a></li></ol>
  </div>
</section>


      
<section class="widet-notice widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-notice" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 945.02305225v28.15620663a24.27259221 24.27259221 0 0 1-24.27259221 24.27259335H394.0352a48.54518557 48.54518557 0 0 1-41.74885888-23.78714112l-110.68302222-184.47170332a132.04290333 132.04290333 0 0 1-17.47626667-48.54518557h118.4502511a200.97706667 200.97706667 0 0 1 76.21594113 14.56355556l20.38897777 133.49925888a48.54518557 48.54518557 0 0 0 36.40888888 27.67075555l16.01991111 2.91271112a24.27259221 24.27259221 0 0 1 20.38897778 25.72894889zM997.45185223 463.45481443a194.18074112 194.18074112 0 0 1-38.8361489 116.50844445 24.75804445 24.75804445 0 0 1-36.4088889 0l-34.95253333-34.95253333a24.27259221 24.27259221 0 0 1-2.91271111-30.58346667 97.09036999 97.09036999 0 0 0 0-106.79940665 24.27259221 24.27259221 0 0 1 2.91271111-30.58346666l34.95253333-34.95253334a24.75804445 24.75804445 0 0 1 18.93262223-7.28177777 26.2144 26.2144 0 0 1 17.47626667 9.70903665A194.18074112 194.18074112 0 0 1 997.45185223 463.45481443z m-194.18074112-388.36148111v776.72296335a48.54518557 48.54518557 0 0 1-48.54518556 48.54518443h-28.64165888a48.54518557 48.54518557 0 0 1-33.98163001-14.07810332l-145.63555556-143.20829668A291.27111111 291.27111111 0 0 0 342.57730333 657.63555556H172.18370333a145.63555556 145.63555556 0 0 1-145.63555556-145.63555556v-97.09036999a145.63555556 145.63555556 0 0 1 145.63555556-145.63555556h170.3936a291.27111111 291.27111111 0 0 0 206.31703779-85.43952668l145.63555555-143.20829554a48.54518557 48.54518557 0 0 1 33.98162888-14.07810446H754.72592555a48.54518557 48.54518557 0 0 1 48.54518556 48.54518555z" fill="currentColor"></path>
</svg>
    <span>NOTICE</span>
  </div>
  <div class="widget-body">
    <p>看到这条通知的请立即微信转账50块，收到扣1</p>
  </div>
</section>


      <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
        <li class="categorys-list-item">
          <a href="/categories/Bullshit/">
            Bullshit (2)
          </a>
        </li>
      
        <li class="categorys-list-item">
          <a href="/categories/Homework/">
            Homework (2)
          </a>
        </li>
      
    </ul>
  </div>
</section>

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>TAGS</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      <a href="/tags/Parallel-Programming/" style="font-size: 10px;" class="tags-cloud-0">Parallel Programming</a> <a href="/tags/RAID/" style="font-size: 10px;" class="tags-cloud-0">RAID</a> <a href="/tags/gpt/" style="font-size: 10px;" class="tags-cloud-0">gpt</a> <a href="/tags/hexo/" style="font-size: 10px;" class="tags-cloud-0">hexo</a>
    </div>
  </div>
</section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <div class="social-icons">
      
        
          <a href="https://www.baidu.com/s?wd=ins" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-ins" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 0C372.906667 0 355.541333 0.64 300.928 3.072 246.4 5.632 209.28 14.208 176.64 26.88c-33.664 13.056-62.250667 30.592-90.709333 59.050667S39.893333 142.933333 26.88 176.64C14.208 209.28 5.589333 246.4 3.072 300.928 0.512 355.541333 0 372.906667 0 512s0.64 156.458667 3.072 211.072c2.56 54.485333 11.136 91.648 23.808 124.288a251.093333 251.093333 0 0 0 59.050667 90.709333A250.368 250.368 0 0 0 176.64 997.12c32.682667 12.629333 69.802667 21.290667 124.288 23.808C355.541333 1023.488 372.906667 1024 512 1024s156.458667-0.64 211.072-3.072c54.485333-2.56 91.648-11.178667 124.288-23.808a251.648 251.648 0 0 0 90.709333-59.050667 250.026667 250.026667 0 0 0 59.050667-90.709333c12.629333-32.64 21.290667-69.802667 23.808-124.288 2.56-54.613333 3.072-71.978667 3.072-211.072s-0.64-156.458667-3.072-211.072c-2.56-54.485333-11.178667-91.690667-23.808-124.288a251.306667 251.306667 0 0 0-59.050667-90.709333A249.472 249.472 0 0 0 847.36 26.88c-32.64-12.672-69.802667-21.290667-124.288-23.808C668.458667 0.512 651.093333 0 512 0z m0 92.16c136.661333 0 152.96 0.682667 206.933333 3.029333 49.92 2.346667 77.013333 10.624 95.018667 17.706667 23.978667 9.258667 40.96 20.352 58.965333 38.229333 17.877333 17.92 28.970667 34.944 38.229334 58.922667 6.997333 18.005333 15.36 45.098667 17.621333 95.018667 2.432 54.016 2.986667 70.229333 2.986667 206.933333s-0.64 152.96-3.157334 206.933333c-2.602667 49.92-10.922667 77.013333-17.962666 95.018667a162.56 162.56 0 0 1-38.357334 58.965333 159.744 159.744 0 0 1-58.88 38.229334c-17.92 6.997333-45.44 15.36-95.36 17.621333-54.357333 2.432-70.357333 2.986667-207.317333 2.986667-137.002667 0-153.002667-0.64-207.317333-3.157334-49.962667-2.602667-77.482667-10.922667-95.402667-17.962666a158.549333 158.549333 0 0 1-58.837333-38.357334 155.477333 155.477333 0 0 1-38.4-58.88c-7.04-17.92-15.317333-45.44-17.92-95.36-1.92-53.76-2.602667-70.357333-2.602667-206.677333 0-136.362667 0.682667-153.002667 2.602667-207.402667 2.602667-49.92 10.88-77.397333 17.92-95.317333 8.96-24.32 20.437333-40.96 38.4-58.922667 17.877333-17.877333 34.56-29.397333 58.837333-38.314666 17.92-7.082667 44.842667-15.402667 94.762667-17.962667 54.4-1.92 70.4-2.56 207.317333-2.56l1.92 1.28z m0 156.928a262.912 262.912 0 1 0 0 525.824 262.912 262.912 0 1 0 0-525.824zM512 682.666667c-94.293333 0-170.666667-76.373333-170.666667-170.666667s76.373333-170.666667 170.666667-170.666667 170.666667 76.373333 170.666667 170.666667-76.373333 170.666667-170.666667 170.666667z m334.762667-443.946667a61.482667 61.482667 0 0 1-122.88 0 61.44 61.44 0 0 1 122.88 0z"></path>
</svg>

          </a>
        
      
        
          <a href="https://www.zhihu.com/" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg t="1587373160860" class="icon icon-zhihu" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M544.949 561.422s0-71.387-34.779-75.050c-34.779-3.663-142.775 0-142.775 0v-219.654h161.078s-1.83-73.219-32.949-73.219h-261.755l43.93-117.148s-65.897 3.663-89.692 45.761-98.844 252.604-98.844 252.604 25.627 10.983 67.726-20.134c42.101-31.116 56.743-86.033 56.743-86.033l76.879-3.663 1.83 223.316s-133.621-1.83-161.078 0c-27.457 1.83-42.101 75.050-42.101 75.050h203.182s-18.307 124.47-69.557 214.164c-53.085 89.692-151.929 161.078-151.929 161.078s71.387 29.287 140.947-10.983c69.557-42.101 120.811-223.316 120.811-223.316l162.912 203.182s14.643-97.013-1.83-124.47c-18.307-27.457-113.49-137.283-113.49-137.283l-42.101 36.607 29.287-120.811h177.552zM587.050 188.010l-1.83 660.793h65.897l23.795 82.37 115.321-82.37h162.912v-660.793h-366.091zM879.92 775.584h-76.879l-97.013 75.050-21.965-75.050h-20.134v-512.527h215.991v512.527z"></path>
</svg>
          </a>
        
      
        
          <a href="https://weibo.com/" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-weibo" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M385.682429 733.696q11.995429-19.456 6.290286-39.424t-25.746286-28.598857q-19.456-7.972571-41.691429-0.585143t-34.304 26.258286q-12.580571 19.456-7.460571 39.131429t24.576 28.891429 42.569143 1.462857 35.693714-27.136zM439.442429 664.576q4.534857-7.460571 1.974857-15.140571t-10.020571-10.605714q-7.972571-2.852571-16.310857 0.292571t-12.288 10.605714q-9.728 17.700571 7.460571 25.746286 7.972571 2.852571 16.603429-0.292571t12.580571-10.605714zM538.843572 725.723429q-25.746286 58.294857-90.258286 85.723429t-128 6.875429q-61.147429-19.456-84.260571-72.265143t3.730286-107.154286q26.843429-53.174857 86.601143-79.433143t120.32-10.825143q63.414857 16.603429 90.550857 68.315429t1.462857 108.836571zM717.165858 634.294857q-5.12-54.857143-50.834286-97.133714t-119.149714-62.317714-156.891429-11.995429q-127.414857 13.165714-211.163429 80.822857t-75.702857 151.113143q5.12 54.857143 50.834286 97.133714t119.149714 62.317714 156.891429 11.995429q127.414857-13.165714 211.163429-80.822857t75.702857-151.113143zM893.147572 636.562286q0 38.838857-21.138286 79.725714t-62.317714 78.262857-96.256 67.145143-129.170286 47.396571-154.550857 17.700571-157.110857-19.163429-137.435429-53.174857-98.011429-86.308571-37.156571-114.029714q0-65.682286 39.716571-139.995429t112.859429-147.456q96.548571-96.548571 195.145143-134.875429t140.873143 4.022857q37.156571 36.571429 11.410286 119.442286-2.267429 7.972571-0.585143 11.410286t5.705143 4.022857 8.265143-0.292571 7.68-1.974857l3.437714-1.170286q79.433143-33.718857 140.580571-33.718857t87.405714 34.889143q25.746286 35.986286 0 101.741714-1.170286 7.460571-2.56 11.410286t2.56 7.168 6.875429 4.315429 9.728 3.437714q32.548571 10.313143 58.88 26.843429t45.714286 46.592 19.456 66.56zM850.871001 279.990857q23.990857 26.843429 31.158857 62.025143t-3.730286 67.145143q-4.534857 13.165714-16.822857 19.456t-25.453714 2.267429q-13.165714-4.534857-19.456-16.822857t-2.267429-25.453714q11.410286-35.986286-13.677714-63.414857t-61.147429-19.968q-13.677714 2.852571-25.746286-4.534857t-14.262857-21.138286q-2.852571-13.677714 4.534857-25.453714t21.138286-14.555429q34.304-7.460571 68.022857 3.145143t57.709714 37.449143zM954.295001 186.88q49.737143 54.857143 64.292571 127.122286t-7.68 138.020571q-5.12 15.433143-19.456 22.820571t-29.696 2.267429-22.820571-19.456-2.852571-29.696q16.018286-46.884571 5.705143-98.304t-45.714286-90.258286q-35.401143-39.424-84.553143-54.564571t-98.889143-4.827429q-16.018286 3.437714-29.696-5.412571t-17.115429-24.868571 5.412571-29.403429 24.868571-16.822857q70.290286-14.848 139.410286 6.582857t118.857143 76.873143z"></path>
</svg>
          </a>
        
      
        
          <a href="https://github.com/morty-idhyuajjcbdchjdehsr" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
        
          <a href="https://www.baidu.com/s?wd=twitter" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-twitter" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M962.285714 233.142857q-38.285714 56-92.571429 95.428571 0.571429 8 0.571429 24 0 74.285714-21.714286 148.285714t-66 142-105.428571 120.285714-147.428571 83.428571-184.571429 31.142857q-154.857143 0-283.428571-82.857143 20 2.285714 44.571429 2.285714 128.571429 0 229.142857-78.857143-60-1.142857-107.428571-36.857143t-65.142857-91.142857q18.857143 2.857143 34.857143 2.857143 24.571429 0 48.571429-6.285714-64-13.142857-106-63.714286t-42-117.428571l0-2.285714q38.857143 21.714286 83.428571 23.428571-37.714286-25.142857-60-65.714286t-22.285714-88q0-50.285714 25.142857-93.142857 69.142857 85.142857 168.285714 136.285714t212.285714 56.857143q-4.571429-21.714286-4.571429-42.285714 0-76.571429 54-130.571429t130.571429-54q80 0 134.857143 58.285714 62.285714-12 117.142857-44.571429-21.142857 65.714286-81.142857 101.714286 53.142857-5.714286 106.285714-28.571429z"></path>
</svg>
          </a>
        
      
    </div>
     
    <p>&copy; 2024 <a href="/" target="_blank">lzf</a></p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <p>
      <a href="javascript:;" id="theme-light">🌞 浅色</a>
      <a href="javascript:;" id="theme-dark">🌛 深色</a>
      <a href="javascript:;" id="theme-auto">🤖️ 自动</a>
    </p>
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


  <!-- aplayer 音频 start -->
  <link rel="stylesheet" href="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.css">
  <script type="text/javascript" src="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js"></script>
  <script type="text/javascript">
    const aplayer = document.querySelectorAll(".aplayer-box");
    aplayer && initaplayer(aplayer);
    function initaplayer(els) {
      let elsArr = Array.from(els);
      elsArr.forEach(el => {
        let params = {
          container: el,
          audio: { ...el.dataset },
          theme: "#b7daff",
          autoplay: false,
          loop: false,
          mutex: true,
        }
        if (el.dataset.lrc) {
          params['lrcType'] = 3
        }
        new APlayer(params);
      });
    }
  </script>
  <!-- aplayer 音频 end -->
  


<!-- dplayer -->


<!-- dplayer 视频 start -->
<script type="text/javascript" src="https://unpkg.com/hls.js@1.4.8/dist/hls.js"></script>
<script type="text/javascript" src="https://unpkg.com/dplayer@1.27.1/dist/DPlayer.min.js"></script>
<script type="text/javascript">
  const dplayer = document.querySelectorAll(".dplayer-box");
  dplayer && initDPlayer(dplayer);
  function initDPlayer(els) {
    let elsArr = Array.from(els);
    elsArr.forEach(el => {
      let url = el.dataset.url;
      let pic = el.dataset.pic;
      let subtitle = el.dataset.subtitle;

      let options = {
        container: el,
        video: { url: url, pic: pic },
        theme: "#b7daff",
        autoplay: false,
        loop: false,
        mutex: true,
      }

      if (subtitle) {
        options.subtitle = {
          url: el.dataset.subtitle,
        }
      }
      new DPlayer(options);
    });
  }
</script>
<!-- dplayer 视频 end -->



<!-- copy button  -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

<!-- https://clipboardjs.com/ -->


<script type="text/javascript">
	(function () {
		function getCodeType (elem) {
			const classs = Array.from(elem.classList.values());
			if (classs && classs.length > 1) {
				return classs[1];
			}
			return "plain";
		}

		window.addEventListener("DOMContentLoaded", () => {
			const copyBtnClass = "copy-btn";
			//  instantiate clipboardjs 
			const clipboard = new ClipboardJS('.' + copyBtnClass);

			clipboard.on('success', function (e) {
				console.info('Action:', e.action);
				console.info('Text:', e.text);
				console.info('Trigger:', e.trigger);
				if (e.trigger) {
					e.trigger.classList.add("copied");
					setTimeout(() => {
						e.trigger.classList.remove("copied");
					}, 3000);
				}
				e.clearSelection();
			});

			clipboard.on('error', function (e) {
				console.error('Action:', e.action);
				console.error('Trigger:', e.trigger);
			});

			document.querySelectorAll('figure.highlight').forEach((elem) => {
				const codeContent = elem.querySelector("td.code");
				const copyButton = document.createElement('button');
				copyButton.setAttribute("class", copyBtnClass);
				copyButton.setAttribute("title", "Copy Code");
				copyButton.setAttribute("data-clipboard-text", codeContent.innerText);
				elem.insertBefore(copyButton, elem.children[0]);
			});
		})
	})();
</script>








  


  


  




<script src="/js/script.js"></script>


  
  <!-- 尾部用户自定义相关内容 -->
</body>
</html>
